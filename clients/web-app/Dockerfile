FROM node:22-alpine as builder
 
ARG MULTIPLAYER_OTLP_KEY
ARG PLATFORM_ENV
ARG VERSION
ARG MULTIPLAYER_OTLP_DOC_SPAN_RATIO
ARG MULTIPLAYER_OTLP_SPAN_RATIO
ARG MULTIPLAYER_OTLP_COLLECTOR_ENDPOINT
ARG REACT_APP_BASE_API_URL

ENV REACT_APP_SESSION_DEBUGGER_KEY=$MULTIPLAYER_OTLP_KEY
ENV REACT_APP_PLATFORM_ENV=$PLATFORM_ENV
ENV REACT_APP_SERVICE_VERSION=$VERSION
ENV REACT_APP_MULTIPLAYER_OTLP_DOC_SPAN_RATIO=$MULTIPLAYER_OTLP_DOC_SPAN_RATIO
ENV REACT_APP_MULTIPLAYER_OTLP_SPAN_RATIO=$MULTIPLAYER_OTLP_SPAN_RATIO
ENV REACT_APP_SESSION_DEBUGGER_API_BASE_URL=$MULTIPLAYER_OTLP_COLLECTOR_ENDPOINT
ENV REACT_APP_BASE_API_URL=$REACT_APP_BASE_API_URL

WORKDIR /app

COPY package*.json ./
 
RUN npm install ci

COPY . .

RUN npm run build

FROM nginx:alpine

COPY nginx/nginx.conf /etc/nginx/nginx.conf

COPY --from=builder /app/build /usr/share/nginx/html

EXPOSE 3000
CMD ["nginx", "-g", "daemon off;"]
